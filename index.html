<html>

<head>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="./xwing-miniatures-font/dist/xwing-miniatures.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        $.getJSON('./xwing-data2/data/manifest.json', function(manifest){
            $.getJSON('./xwing-data2/'+manifest.factions[0], function(factions){
                $.each(factions, function(index, val){
                    $("#faction").append('<option value="'+val.xws+'">'+val.name+'</option>');
                }); 
            });
        });


    </script>
    
</head>



<body>
    <form>
    <select id="faction">
        <option selected>Select Faction</option>
    </select>
    <select id="ship" disabled>
        <option selected>Select Ship</option>
    </select>
    <select id="pilot" disabled>
        <option selected>Select Pilot</option>
    </select>
    </form>
    <div class="w3-card-4" style="max-width: 500px; max-height: 700px;">
        <div class="w3-display-container">
            <img src="https://via.placeholder.com/700x350.png" alt="pilot image" style="width:100%;" id="card_image" class="card_field">
            <div class="w3-xlarge w3-display-bottomleft w3-padding"><span id="pilot_name" class="card_field"></span>
            <br>
                <span id="pilot_title" class="w3-medium card_field" style="font-style: italic;"></span>
            </div>
            <div class="w3-xlarge w3-display-topleft w3-padding w3-light-grey">
                <span id="pilot_initiative" class="card_field"></span>
            </div>
        </div>
        <div class="w3-container">
            <div id="ship_ability" class="w3-panel w3-light-grey">
                <p id="ship_name" class="w3-center card_field"></p><br>
                <p id="ship_ability_name" class="card_field" style="font-weight: bold;"></p><br>
                <p id="ship_ability_text" class="card_field"></p>
            </div>
            <div id="pilot_ability" class="card_field"></div>
            <i id="flavor_text" class="card_field"></i>
            <hr>
            <i class="xwing-miniatures-font xwing-miniatures-font-agility"></i>
            
        </div>
    </div>
   
    <script>
        var current_faction = '';
        var current_ship = '';
        var current_pilot = '';
        
        $('#faction').change(function(){
            $('#ship_name').text('');
            $('#pilot_name').text('');
            $('#pilot_title').text('');
            
            $.getJSON('./xwing-data2/data/manifest.json', function(manifest){
                
                for (var i = 0; i < manifest.pilots.length; i++){
                    console.log(manifest.pilots[i]);
                    if ($("#faction option:selected").val() === manifest.pilots[i].faction){
                        current_faction = manifest.pilots[i];
                        for (var j = 0; j < manifest.pilots[i].ships.length; j++){
                            
                            $("#ship").empty();
                            $("#ship").removeAttr("disabled");
                            $('#pilot').empty();               
                            $('#pilot').prop("disabled", true);
                            $('#ship').append('<option selected>Select Ship</option>');
                            $('#pilot').append('<option selected>Select Pilot</option>');
                            $.getJSON('./xwing-data2/'+manifest.pilots[i].ships[j], function(ship){
                                    $("#ship").append('<option value="'+ship.xws+'">'+ship.name+'</option>');
                                });
                        }
                    }
                }
            });
        });
        $('#ship').change(function(){
            
            $('#ship_name').text('');
            $('#pilot_name').text('');
            $('#pilot_title').text('');
              $.getJSON('./xwing-data2/data/manifest.json', function(manifest){
             for (var i = 0; i < manifest.pilots.length; i++){
                    console.log(manifest.pilots[i]);
                    if ($("#faction option:selected").val() === manifest.pilots[i].faction){
                        for (var j = 0; j < manifest.pilots[i].ships.length; j++){
                            
                            $("#pilot").empty();
                            
                            $("#pilot").removeAttr("disabled");
                            $.getJSON('./xwing-data2/'+manifest.pilots[i].ships[j], function(ship){
                                if (ship.xws === $('#ship option:selected').val()){
                                    current_ship = ship;
                                    $('#pilot').append('<option selected>Select Pilot</option>');
                                    for (var k = 0; k < ship.pilots.length; k++){
                                    $("#pilot").append('<option value="'+ship.pilots[k].xws+'">'+ship.pilots[k].name+'</option>');
                                }}
                            });
                        }
                    }
                }
        });
        });
        
        $('#pilot').change(function(){
            
            for (var i = 0; i < current_ship.pilots.length; i++){
                if (current_ship.pilots[i].xws === $('#pilot option:selected').val()){
                    current_pilot = current_ship.pilots[i];
                }
            }
        });
        
        $('form').change(function(){
            $('.card_field').empty();
            $('#ship_name').append(updateField(current_ship, 'name'));
            $('#pilot_initiative').append(updateField(current_pilot, 'initiative'));
            $('#flavor_text').append(updateField(current_pilot, 'text'));
            $('#pilot_title').append(updateField(current_pilot, 'caption'));
            $('#pilot_name').append(updateField(current_pilot, 'name'));
            $('#pilot_ability').append(updateField(current_pilot, 'ability'));
            
            $('#ship_ability_name').append(updateField(current_pilot, 'shipAbility').name);
            $('#ship_ability_text').append(updateField(current_pilot, 'shipAbility').text);
        });
        
        function updateField(item, field){
            if ((item).hasOwnProperty(field)){
                return item[field];
            } else {
                return '';
            }
        }

        function convertIconSymbol(iconSymbol){
           $.getJSON('./xwing-miniatures-font/src/json/icons-map.json', function(icons){
                var keys = Object.keys(icons.icons);
                console.log(keys);
               });
                     }
        function convertSymbol(symbolText){
            switch(symbolText){
case "agility": return "\u005e";
case "astromech": return "\u0041";
case "attack": return "\u0025";
case "bankleft": return "\u0037";
case "bankright": return "\u0039";
case "barrelroll": return "\u0072";
case "base-all": return "\u00c0";
case "base-small": return "\u00c1";
case "base-medium": return "\u00c2";
case "base-large": return "\u00c3";
case "boost": return "\u0062";
case "bullseyearc": return "\u007d";
case "calculate": return "\u0061";
case "cannon": return "\u0043";
case "cargo": return "\u0047";
case "charge": return "\u0067";
case "cloak": return "\u006b";
case "condition-outline": return "\u00c6";
case "condition": return "\u00b0";
case "config": return "\u006e";
case "coordinate": return "\u006f";
case "crew": return "\u0057";
case "crit": return "\u0063";
case "dalan-bankleft": return "\u005b";
case "dalan-bankright": return "\u005d";
case "device": return "\u0042";
case "doubleturretarc": return "\u0071";
case "empire": return "\u0040";
case "energy": return "\u0028";
case "epic": return "\u0029";
case "evade": return "\u0065";
case "firstorder": return "\u002b";
case "focus": return "\u0066";
case "forcecharge": return "\u0068";
case "forcepower": return "\u0046";
case "frontarc": return "\u007b";
case "fullfrontarc": return "\u007e";
case "fullreararc": return "\u00a1";
case "gunner": return "\u0059";
case "hardpoint": return "\u0048";
case "helmet-imperial": return "\u0079";
case "helmet-rebel": return "\u0078";
case "helmet-scum": return "\u007a";
case "hit": return "\u0064";
case "hull": return "\u0026";
case "ig88d-sloopleft": return "\u0022";
case "ig88d-sloopright": return "\u0027";
case "illicit": return "\u0049";
case "jam": return "\u006a";
case "kturn": return "\u0032";
case "leftarc": return "\u00a3";
case "linked": return "\u003e";
case "lock": return "\u006c";
case "missile": return "\u004d";
case "modification": return "\u006d";
case "obstacle-core2asteroid0-outline": return "\u0109";
case "obstacle-core2asteroid0": return "\u0125";
case "obstacle-core2asteroid1-outline": return "\u010c";
case "obstacle-core2asteroid1": return "\u0128";
case "obstacle-core2asteroid2-outline": return "\u010a";
case "obstacle-core2asteroid2": return "\u0126";
case "obstacle-core2asteroid3-outline": return "\u010b";
case "obstacle-core2asteroid3": return "\u0127";
case "obstacle-core2asteroid4-outline": return "\u010d";
case "obstacle-core2asteroid4": return "\u0129";
case "obstacle-core2asteroid5-outline": return "\u010e";
case "obstacle-core2asteroid5": return "\u012a";
case "obstacle-coreasteroid0-outline": return "\u0102";
case "obstacle-coreasteroid0": return "\u011e";
case "obstacle-coreasteroid1-outline": return "\u0103";
case "obstacle-coreasteroid1": return "\u011f";
case "obstacle-coreasteroid2-outline": return "\u0101";
case "obstacle-coreasteroid2": return "\u011d";
case "obstacle-coreasteroid3-outline": return "\u0105";
case "obstacle-coreasteroid3": return "\u0121";
case "obstacle-coreasteroid4-outline": return "\u0104";
case "obstacle-coreasteroid4": return "\u0120";
case "obstacle-coreasteroid5-outline": return "\u0100";
case "obstacle-coreasteroid5": return "\u011c";
case "obstacle-vt49decimatordebris0-outline": return "\u0110";
case "obstacle-vt49decimatordebris0": return "\u012c";
case "obstacle-vt49decimatordebris1-outline": return "\u0111";
case "obstacle-vt49decimatordebris1": return "\u012d";
case "obstacle-vt49decimatordebris2-outline": return "\u0107";
case "obstacle-vt49decimatordebris2": return "\u0123";
case "obstacle-yt2400debris0-outline": return "\u010f";
case "obstacle-yt2400debris0": return "\u012b";
case "obstacle-yt2400debris1-outline": return "\u0108";
case "obstacle-yt2400debris1": return "\u0124";
case "obstacle-yt2400debris2-outline": return "\u0106";
case "obstacle-yt2400debris2": return "\u0122";
case "rangebonusindicator": return "\u003f";
case "reararc": return "\u007c";
case "rebel-outline": return "\u002d";
case "rebel": return "\u0021";
case "recover": return "\u0076";
case "recurring": return "\u0060";
case "reinforce": return "\u0069";
case "reload": return "\u003d";
case "republic": return "\u002f";
case "reversebankleft": return "\u004a";
case "reversebankright": return "\u004c";
case "reversestraight": return "\u004b";
case "rightarc": return "\u00a2";
case "rotatearc": return "\u0052";
case "scum": return "\u0023";
case "separatists": return "\u002e";
case "sensor": return "\u0053";
case "shield": return "\u002a";
case "singleturretarc": return "\u0070";
case "slam": return "\u0073";
case "sloopleft": return "\u0031";
case "sloopright": return "\u0033";
case "squad-point-cost": return "\u0030";
case "stop": return "\u0035";
case "straight": return "\u0038";
case "tacticalrelay": return "\u005a";
case "talent": return "\u0045";
case "team": return "\u0054";
case "tech": return "\u0058";
case "title": return "\u0074";
case "token-calculate-outline": return "\u00cb";
case "token-calculate": return "\u00ca";
case "token-charge-outline": return "\u00d3";
case "token-charge": return "\u00d2";
case "token-crit-outline": return "\u00e8";
case "token-crit": return "\u00c7";
case "token-cloak-outline": return "\u00f4";
case "token-cloak": return "\u00e5";
case "token-evade-outline": return "\u00e9";
case "token-evade": return "\u00c5";
case "token-focus-outline": return "\u00e7";
case "token-focus": return "\u00c4";
case "token-force-outline": return "\u00d5";
case "token-force": return "\u00d4";
case "token-disarm-outline": return "\u00ed";
case "token-disarm": return "\u00d6";
case "token-ion-outline": return "\u00f3";
case "token-ion": return "\u00e4";
case "token-jam-outline": return "\u00f0";
case "token-jam": return "\u00e1";
case "token-lock-outline": return "\u00f2";
case "token-lock": return "\u00e3";
case "token-reinforce-outline": return "\u00ec";
case "token-reinforce": return "\u00dc";
case "token-reinforceaft-outline": return "\u00ee";
case "token-reinforceaft": return "\u00dd";
case "token-shield-outline": return "\u00eb";
case "token-shield": return "\u00d1";
case "token-stress-outline": return "\u00ea";
case "token-stress": return "\u00c9";
case "token-tractor-outline": return "\u00ef";
case "token-tractor": return "\u00e0";
case "torpedo": return "\u0050";
case "trollleft": return "\u003a";
case "trollright": return "\u003b";
case "turnleft": return "\u0034";
case "turnright": return "\u0036";
case "turret": return "\u0055";
case "unique-outline": return "\u2022";
case "unique": return "\u0075";}
        }
    </script>
</body>
</html>
