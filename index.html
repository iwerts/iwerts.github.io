<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        $.getJSON('./xwing-data2/data/manifest.json', function(manifest){
            $.getJSON('./xwing-data2/'+manifest.factions[0], function(factions){
                $.each(factions, function(index, val){
                    console.log(val);
                    $("#faction").append('<option value="'+val.xws+'">'+val.name+'</option>');
                }); 
            });
        });


    </script>
</head>



<body>
    <select id="faction">

    </select>
    <select id="ship">

    </select>
    <select id="pilot">

    </select>

    <script>
        $('#faction').change(function(){
            
            $("#ship option").remove();
            $.getJSON('./xwing-data2/data/manifest.json', function(manifest){
                
                for (var i = 0; i < manifest.pilots.length; i++){
                    console.log(manifest.pilots[i]);
                    if ($("#faction option:selected").val() === manifest.pilots[i].faction){
                        for (var j = 0; j < manifest.pilots[i].ships.length; j++){
                            $.getJSON('./xwing-data2/'+manifest.pilots[i].ships[j], function(ship){
                                    $("#ship").append('<option value="'+ship.xws+'">'+ship.name+'</option>');
                                });
                        }
                    }
                }
            });
        });
        $('#faction').change(function(){
            
            $("#ship option").remove();
            $.getJSON('./xwing-data2/data/manifest.json', function(manifest){     
                for (var i = 0; i < manifest.pilots.length; i++){
                    console.log(manifest.pilots[i]);
                    if ($("#faction option:selected").val() === manifest.pilots[i].faction){
                        for (var j = 0; j < manifest.pilots[i].ships.length; j++){
                            $.getJSON('./xwing-data2/'+manifest.pilots[i].ships[j], function(ship){
                                if (ship.xws === $('#ship option:selected').val()){
                                    $.each(ship.pilots, function(index, val){
                                    $("#ship").append('<option value="'+val.xws+'">'+val.name+'</option>');       
                                        )};
                                }
                                 });
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
