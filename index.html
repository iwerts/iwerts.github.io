<html>

<head>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        $.getJSON('./xwing-data2/data/manifest.json', function(manifest){
            $.getJSON('./xwing-data2/'+manifest.factions[0], function(factions){
                $.each(factions, function(index, val){
                    console.log(val);
                    $("#faction").append('<option value="'+val.xws+'">'+val.name+'</option>');
                }); 
            });
        });


    </script>
    
</head>



<body>
    <form>
    <select id="faction">
        <option selected>Select Faction</option>
    </select>
    <select id="ship" disabled>
        <option selected>Select Ship</option>
    </select>
    <select id="pilot" disabled>
        <option selected>Select Pilot</option>
    </select>
    </form>
    <div class="w3-card-4" style="max-width: 500px; max-height: 700px;">
        <div class="w3-display-container">
            <img src="https://via.placeholder.com/700" alt="pilot image" style="width:100%;">
            <div class="w3-xlarge w3-display-bottomleft w3-padding"><span id="pilot_name"></span>
            <br>
            <span id="pilot_title" class="w3-small"></span></div>
        </div>
        <div class="w3-container">
            <div id="ship_ability">
                <b id="ship_ability_name"></b>
                <p id="ship_ability_text"></p>
            </div>
            <div id="pilot_ability"></div>
            <i id="flavor_text"></i>
        </div>
    </div>
   
    <script>
        var current_faction = '';
        var current_ship = '';
        var current_pilot = '';
        
        $('#faction').change(function(){
            $('#ship_name').text('');
            $('#pilot_name').text('');
            $('#pilot_title').text('');
            
            $.getJSON('./xwing-data2/data/manifest.json', function(manifest){
                
                for (var i = 0; i < manifest.pilots.length; i++){
                    console.log(manifest.pilots[i]);
                    if ($("#faction option:selected").val() === manifest.pilots[i].faction){
                        current_faction = manifest.pilots[i];
                        for (var j = 0; j < manifest.pilots[i].ships.length; j++){
                            
                            $("#ship").empty();
                            $("#ship").removeAttr("disabled");
                            $('#pilot').empty();               
                            $('#pilot').prop("disabled", true);
                            $('#ship').append('<option selected>Select Ship</option>');
                            $('#pilot').append('<option selected>Select Pilot</option>');
                            $.getJSON('./xwing-data2/'+manifest.pilots[i].ships[j], function(ship){
                                    $("#ship").append('<option value="'+ship.xws+'">'+ship.name+'</option>');
                                });
                        }
                    }
                }
            });
        });
        $('#ship').change(function(){
            
            $('#ship_name').text('');
            $('#pilot_name').text('');
            $('#pilot_title').text('');
              $.getJSON('./xwing-data2/data/manifest.json', function(manifest){
             for (var i = 0; i < manifest.pilots.length; i++){
                    console.log(manifest.pilots[i]);
                    if ($("#faction option:selected").val() === manifest.pilots[i].faction){
                        for (var j = 0; j < manifest.pilots[i].ships.length; j++){
                            
                            $("#pilot").empty();
                            
                            $("#pilot").removeAttr("disabled");
                            $.getJSON('./xwing-data2/'+manifest.pilots[i].ships[j], function(ship){
                                if (ship.xws === $('#ship option:selected').val()){
                                    current_ship = ship;
                                    $('#pilot').append('<option selected>Select Pilot</option>');
                                    for (var k = 0; k < ship.pilots.length; k++){
                                    $("#pilot").append('<option value="'+ship.pilots[k].xws+'">'+ship.pilots[k].name+'</option>');
                                }}
                            });
                        }
                    }
                }
        });
        });
        
        $('#pilot').change(function(){
            
            for (var i = 0; i < current_ship.pilots.length; i++){
                if (current_ship.pilots[i].xws === $('#pilot option:selected').val()){
                    current_pilot = current_ship.pilots[i];
                }
            }
        });
        
        $('form').change(function(){
            $('#ship_name').empty();
            $('#pilot_name').empty();
            $('#pilot_title').empty();
            $('#ship_ability').empty();
            $('#pilot_ability').empty();
            $('#flavor_text').empty();
            
            $('#ship_name').text(current_ship.name);
            $('#pilot_name').text(current_pilot.name);
            if ((current_pilot).hasOwnProperty('caption')){
            
                $('#pilot_title').text(current_pilot.caption);
            
            } else {
            
                $('#pilot_title').text('');
            
            }
            
            if((current_pilot).hasOwnProperty('shipAbility')){
                $('#ship_ability #ship_ability_name').append(current_pilot.shipAbility.name);
                $('#ship_ability #ship_ability_name').append(' : ');
                $('#ship_ability #ship_ability_text').append(current_pilot.shipAbility.text);
            } else {
                $('#ship_ability #ship_ability_name').text('');
                $('#ship_ability #ship_ability_text').text('');
            }
            
            if((current_pilot).hasOwnProperty('ability')){
                $('#pilot_ability').text(current_pilot.ability);
            } else {
                $('#pilot_ability').text('');
            }
            
            if((current_pilot).hasOwnProperty('text')){
                $('#flavor_text').append(current_pilot.text);
            } else {
                $('#flavor_text').text('');
            }
        });
    </script>
</body>
</html>
